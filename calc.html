<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculator</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>

    <div class="container">
        <div id="display">0</div>
        <button id="clear">AC</button>
        <button id="esc">Esc</button>
        <button id="plusminus">&plusmn;</button>
        <button id="decimal">.</button>

        <button class="number" id="one">1</button>
        <button class="number" id="two">2</button>
        <button class="number" id="three">3</button>
        <button class="operator" id="add">&plus;</button>

        <button class="number" id="four">4</button>
        <button class="number" id="five">5</button>
        <button class="number" id="six">6</button>
        <button class="operator" id="subtract">&minus;</button>

        <button class="number" id="seven">7</button>
        <button class="number" id="eight">8</button>
        <button class="number" id="nine">9</button>
        <button class="operator" id="multiply">&times;</button>


        <button class="number" id="zero">0</button>
        <button id="equals">&equals;</button>
        <button class="operator" id="divide">&divide;</button>



    </div>
</body>

<script>

    const equalsButton = document.getElementById("equals")
    const addButton = document.getElementById("add")
    const subtractButton = document.getElementById("subtract")
    const multiplyButton = document.getElementById("multiply")
    const divideButton = document.getElementById("divide")
    const clearButton = document.getElementById("clear")
    const decimalButton = document.getElementById("decimal")
    const escButton = document.getElementById("esc")
    const display = document.getElementById("display")

    let firstOperand;
    let secondOperand;
    let currentOperator;
    let currentResult;

    // Operate functionality
    function operate(operator, a, b) {

        switch (operator) {
            case "+":
                res = add(a, b)
                return res
            case "-":
                res = subtract(a, b)
                return res
            case "*":
                res = multiply(a, b)
                return res
            case "/":
                res = divide(a, b)
                return res
        }
    }

    function add(a, b) {
        return a + b
    }

    function subtract(a, b) {
        return a - b
    }
    function multiply(a, b) {
        return a * b
    }
    function divide(a, b) {
        return b === 0 ? "Nem." : a / b
    }

    // Operator buttons
    operatorButtons = document.querySelectorAll(".operator")
    operatorButtons.forEach((btn) => btn.addEventListener('click', setOperator))

    addButton.setAttribute('operator', '+')
    subtractButton.setAttribute('operator', '-')
    multiplyButton.setAttribute('operator', '*')
    divideButton.setAttribute('operator', '/')

    function setOperator(e) {
        if (display.textContent == currentResult) {
            firstOperand = currentResult
            secondOperand = ''
        }
        if (currentOperator) {
            firstOperand = operate(currentOperator, parseFloat(firstOperand), parseFloat(secondOperand))
            secondOperand = ''
        }
        if (e.target.id == "subtract" && !firstOperand) {
            firstOperand = '-'
            display.textContent = firstOperand
        }

        else {
            currentOperator = e.target.getAttribute('operator')
            display.textContent += currentOperator
        }


    }

    // Number buttons
    numberButtons = document.querySelectorAll(".number")
    numberButtons.forEach((btn) => btn.addEventListener('click', setOperand))

    function setOperand(e) {
        operand = e.target.textContent

        if (!firstOperand) {
            firstOperand = operand
            display.textContent = operand
            secondOperand = ''
            currentResult = firstOperand
        }
        else if (firstOperand && !currentOperator) {
            firstOperand += operand
            display.textContent += operand
            secondOperand = ''
        }
        else if (firstOperand && currentOperator) {
            secondOperand += operand
            display.textContent += operand
        }
    }

    // Equals button
    equalsButton.addEventListener('click', equalsListener)

    function equalsListener(e) {
        if (firstOperand && secondOperand) {
            currentResult = operate(currentOperator, parseFloat(firstOperand), parseFloat(secondOperand)).toFixed(1)
            splitResult = currentResult.split(".")
            // Truncate number if ending in '.0'
            if (splitResult[splitResult.length - 1] === '0') {
                currentResult = Math.trunc(parseInt(currentResult))
            }
        }
        else {
            currentResult = '0'

        }
        display.textContent = currentResult
        currentOperator = null
        firstOperand = null
        secondOperand = null
    }



    // Clear button
    clearButton.addEventListener('click', clearListener)

    function clearListener() {
        firstOperand = ''
        secondOperand = ''
        currentOperator = ''
        currentResult = '0'
        display.textContent = '0'
    }

    // Decimal button    
    decimalButton.addEventListener('click', decimalListener)

    function decimalListener() {

        if (!firstOperand) {
            firstOperand = ''
        }
        else if (!currentOperator && !firstOperand.includes(".")) {
            firstOperand += "."
            display.textContent += "."

        }
        else if (currentOperator && !secondOperand.includes(".")) {
            secondOperand += "."
            display.textContent += "."
        }

    }

    // Backspace button
    escButton.addEventListener('click', escListener)

    function escListener() {
        if (!firstOperand && currentResult) {
            firstOperand = currentResult.toString()
            secondOperand = ''
        }

        if (firstOperand.length == 1) {
            firstOperand = '0'
            display.textContent = '0'

        }
        else {
            if (firstOperand && !currentOperator) {
                firstOperand = firstOperand.slice(0, -1)
            }
            else if (currentOperator && (!secondOperand)) {
                currentOperator = null
            }
            else {
                secondOperand = secondOperand.slice(0, -1)
            }

            display.textContent = display.textContent.slice(0, -1)
        }
    }

</script>

</html>